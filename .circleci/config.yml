version: 2.1

jobs:
  build-webgl:
    docker:
      - image: unityci/editor:6000.2.10f1-webgl
    working_directory: /root/project
    environment:
      UNITY_BUILD_TARGET: WebGL
      BUILD_OUTPUT: /root/build
    steps:
      - checkout

      # Instalar dependencias si es necesario (npm, dotnet, etc)
      # - run: apt-get update && apt-get install -y <paquetes>

      # Mostrar versi√≥n de Unity y verificar WebGL
      - run:
          name: Show Unity Version
          command: |
            /opt/unity/Editor/Unity -batchmode -quit -version
            /opt/unity/Editor/Unity -batchmode -quit -projectPath /root/project -executeMethod BuildWebGL.PerformBuild -logFile /dev/stdout

      # Ejecutar build
      - run:
          name: Build WebGL
          command: |
            mkdir -p $BUILD_OUTPUT
            /opt/unity/Editor/Unity \
              -batchmode \
              -nographics \
              -silent-crashes \
              -projectPath /root/project \
              -executeMethod BuildWebGL.PerformBuild \
              -logFile /dev/stdout \
              -quit

      # Guardar artifacts
      - persist_to_workspace:
          root: $BUILD_OUTPUT
          paths:
            - .

workflows:
  version: 2
  build-and-store:
    jobs:
      - build-webgl
